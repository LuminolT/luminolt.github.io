<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.6.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=author content="Luminol Chen"><meta name=description content="POSIXçº¿ç¨‹åº“å°æ‰‹å†Œ"><link rel=alternate hreflang=en-us href=https://example.com/post/pthreads/><meta name=theme-color content="#1565c0"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css integrity="sha512-W0xM4mr6dEP9nREo7Z9z+9X70wytKvMGeDsj7ps2+xg5QPrEBXC8tAW1IFnzjR6eoJ90JmCnFzerQJTLzIEHjA==" crossorigin=anonymous media=print onload='this.media="all"'><link rel=stylesheet href=/css/wowchemy.3495fc6150afdd177f1d04fbba9f5e2c.css><link rel=stylesheet href=/css/libs/chroma/github-light.min.css title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=/css/libs/chroma/dracula.min.css title=hl-dark media=print onload='this.media="all"' disabled><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu1b90dea3b5752ec4ed6154c0dc881a21_30314_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu1b90dea3b5752ec4ed6154c0dc881a21_30314_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://example.com/post/pthreads/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wowchemy"><meta property="twitter:creator" content="@wowchemy"><meta property="og:site_name" content="Luminolt"><meta property="og:url" content="https://example.com/post/pthreads/"><meta property="og:title" content="A Brief Mannual to POSIX threads | Luminolt"><meta property="og:description" content="POSIXçº¿ç¨‹åº“å°æ‰‹å†Œ"><meta property="og:image" content="https://example.com/post/pthreads/featured.jpg"><meta property="twitter:image" content="https://example.com/post/pthreads/featured.jpg"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2022-10-11T17:44:37+08:00"><meta property="article:modified_time" content="2022-10-11T17:44:37+08:00"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://example.com/post/pthreads/"},"headline":"A Brief Mannual to POSIX threads","image":["https://example.com/post/pthreads/featured.jpg"],"datePublished":"2022-10-11T17:44:37+08:00","dateModified":"2022-10-11T17:44:37+08:00","author":{"@type":"Person","name":"Luminol Chen"},"publisher":{"@type":"Organization","name":"Luminolt","logo":{"@type":"ImageObject","url":"https://example.com/media/icon_hu1b90dea3b5752ec4ed6154c0dc881a21_30314_192x192_fill_lanczos_center_3.png"}},"description":"POSIXçº¿ç¨‹åº“å°æ‰‹å†Œ"}</script><title>A Brief Mannual to POSIX threads | Luminolt</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=11a394827d6936cc73c794185d3a2706><script src=/js/wowchemy-init.min.613040fe4f2c0f007b4dcb64404201cb.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=Close><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search class=form-control aria-label=Search...></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Luminolt</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Luminolt</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/#about><span>Home</span></a></li><li class=nav-item><a class=nav-link href=/#posts><span>Posts</span></a></li><li class=nav-item><a class=nav-link href=/guide><span>Guide</span></a></li><li class=nav-item><a class=nav-link href=/friend><span>Friend</span></a></li><li class=nav-item><a class=nav-link href=/#contact><span>Contact</span></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=Search><i class="fas fa-search" aria-hidden=true></i></a></li><li class="nav-item dropdown theme-dropdown"><a href=# class=nav-link data-toggle=dropdown aria-haspopup=true aria-label="Display preferences"><i class="fas fa-moon" aria-hidden=true></i></a><div class=dropdown-menu><a href=# class="dropdown-item js-set-theme-light"><span>Light</span></a>
<a href=# class="dropdown-item js-set-theme-dark"><span>Dark</span></a>
<a href=# class="dropdown-item js-set-theme-auto"><span>Automatic</span></a></div></li></ul></div></nav></header></div><div class=page-body><article class=article><div class="article-container pt-3"><h1>A Brief Mannual to POSIX threads</h1><p class=page-subtitle>POSIXçº¿ç¨‹åº“å°æ‰‹å†Œ</p><div class=article-metadata><div><span class=author-highlighted>Luminol Chen</span>, <span>olivanpa</span>, <span>nofevid</span>, <span>crazylian</span></div><span class=article-date>Oct 11, 2022</span>
<span class=middot-divider></span>
<span class=article-reading-time>3 min read</span>
<span class=middot-divider></span>
<span class=article-categories><i class="fas fa-folder mr-1"></i><a href=/category/operating-system/>Operating System</a></span></div></div><div class="article-header article-container featured-image-wrapper mt-4 mb-4" style=max-width:720px;max-height:344px><div style=position:relative><img src=/post/pthreads/featured_hucbce8cd2cbe7bc310a175b94c26e207b_43609_720x2500_fit_q75_h2_lanczos.webp width=720 height=344 alt class=featured-image></div></div><div class=article-container><div class=article-style><h2 id=lead-in>Lead in</h2><blockquote><p>Aï¼šğŸ¤”ä¸ºä»€ä¹ˆæˆ‘å†™çš„ç¨‹åºè·‘çš„è¿™ä¹ˆæ…¢å‘¢</p><p>Bï¼šğŸ˜‚check the serverï¼Œä¸€æ ¸æœ‰éš¾ä¸‡æ ¸å›´è§‚</p></blockquote><img src=https://picgo-1303220879.cos.ap-shanghai.myqcloud.com/img/20221011090209.png width=300 align=center><p>åœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿè¶Šæ¥è¶Šæ™®åŠçš„æ—¶ä»£ï¼Œä½ éœ€è¦å­¦ä¹ â€”â€”å¹¶å‘ç¼–ç¨‹ï¼</p><p>POSIX ä¸ºæˆ‘ä»¬æä¾›äº†çº¿ç¨‹åº“ (pthreads)ï¼Œè¿™æ˜¯åœ¨å¤šæ ¸å¹³å°ä¸Šè¿›è¡Œå¹¶å‘ç¼–ç¨‹çš„ä¸€å¥—APIã€‚</p><p>æœ¬æ–‡ï¼Œæˆ‘ä»¬ä»‹ç»ä¸‰ä¸ªå†…å®¹ï¼š</p><ul><li>å¦‚ä½•ä½¿ç”¨pthreadsåº“åˆ›å»ºå¹¶å‘çº¿ç¨‹</li><li>å¦‚ä½•ä½¿ç”¨pthreadsåº“å®ç°çº¿ç¨‹åŒæ­¥ï¼ˆå³OSåŒæ­¥åŸè¯­çš„ä½¿ç”¨ï¼‰</li><li>çº¿ç¨‹APIçš„ä½¿ç”¨å‡†åˆ™</li></ul><blockquote><p>Recallï¼šåœ¨ä½“ç³»ç»“æ„è¯¾ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†<a href=https://en.wikipedia.org/wiki/OpenMP target=_blank rel=noopener>OpenMP</a>ï¼Œä¹Ÿæ˜¯å¹¶å‘ç¼–ç¨‹çš„ä¸€å¥—æ¥å£ï¼Œ
å…¶è§„èŒƒåœ¨ç¼–è¯‘å™¨ä¸Šå®ç°ï¼Œç›¸è¾ƒäºpthreadsæ›´æ˜“äºæ‰©å±•ã€‚</p></blockquote><h2 id=1-çº¿ç¨‹çš„åˆ›å»ºå’Œä½¿ç”¨>1 çº¿ç¨‹çš„åˆ›å»ºå’Œä½¿ç”¨</h2><h3 id=11-ä¸»è¦å‡½æ•°æ¥å£>1.1 ä¸»è¦å‡½æ•°æ¥å£</h3><table><thead><tr><th>å‡½æ•°å</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td><code>int pthread_create()</code></td><td>åˆ›å»ºçº¿ç¨‹</td></tr><tr><td><code>int pthread_detach()</code></td><td>åˆ†ç¦»çº¿ç¨‹</td></tr><tr><td><code>int pthread_equal()</code></td><td>æ¯”è¾ƒçº¿ç¨‹ ID</td></tr><tr><td><code>void pthread_exit()</code></td><td>ç»ˆæ­¢çº¿ç¨‹</td></tr><tr><td><code>int pthread_join()</code></td><td>æŒ‚èµ·å¹¶ç­‰å¾…æŒ‡å®šçº¿ç¨‹ç»ˆæ­¢</td></tr><tr><td><code>int pthread_kill()</code></td><td>å‘çº¿ç¨‹å‘é€ä¿¡å·</td></tr><tr><td><code>int pthread_once()</code></td><td>ä»…ä¸€æ¬¡è°ƒç”¨æŒ‡å®šå‡½æ•°</td></tr><tr><td><code>pthread_t pthread_self()</code></td><td>è¿”å›çº¿ç¨‹ ID</td></tr><tr><td><code>int pthread_cancel()</code></td><td>å‘çº¿ç¨‹å‘é€å–æ¶ˆä¿¡å·</td></tr><tr><td><code>int pthread_setcancelstate()</code></td><td>è®¾ç½®æœ¬çº¿ç¨‹å¯¹å–æ¶ˆä¿¡å·çš„ååº”</td></tr><tr><td><code>int pthread_setcanceltype()</code></td><td>è®¾ç½®æœ¬çº¿ç¨‹å–æ¶ˆåŠ¨ä½œçš„æ‰§è¡Œæ—¶æœº</td></tr><tr><td><code>void pthread_testcancel()</code></td><td>åˆ›å»ºçº¿ç¨‹å–æ¶ˆç‚¹</td></tr></tbody></table><h3 id=12-æ¥å£ç”¨æ³•>1.2 æ¥å£ç”¨æ³•</h3><h4 id=121-åˆ›å»ºçº¿ç¨‹>1.2.1 åˆ›å»ºçº¿ç¨‹</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>pthread_create</span><span class=p>(</span><span class=kt>pthread_t</span> <span class=o>*</span><span class=kr>thread</span><span class=p>,</span> <span class=k>const</span> <span class=kt>pthread_attr_t</span> <span class=o>*</span><span class=n>attr</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=kt>void</span> <span class=o>*</span><span class=p>(</span><span class=o>*</span><span class=n>start_routine</span><span class=p>)(</span><span class=kt>void</span> <span class=o>*</span><span class=p>),</span> <span class=kt>void</span> <span class=o>*</span><span class=n>arg</span><span class=p>)</span>
</span></span></code></pre></div><ul><li><p><code>pthread_t *thread</code> ï¼šä¼ é€’ä¸€ä¸ª <code>pthread_t</code> ç±»å‹çš„æŒ‡é’ˆå˜é‡ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¼ é€’æŸä¸ª <code>pthread_t</code> ç±»å‹å˜é‡çš„åœ°å€ã€‚</p></li><li><p><code>const pthread_attr_t *attr</code>ï¼šç”¨äºæ‰‹åŠ¨è®¾ç½®æ–°å»ºçº¿ç¨‹çš„å±æ€§ï¼Œä¾‹å¦‚çº¿ç¨‹çš„è°ƒç”¨ç­–ç•¥ã€çº¿ç¨‹æ‰€èƒ½ä½¿ç”¨çš„æ ˆå†…å­˜çš„å¤§å°ç­‰ã€‚å¤§éƒ¨åˆ†åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬éƒ½ä¸éœ€è¦æ‰‹åŠ¨ä¿®æ”¹çº¿ç¨‹çš„å±æ€§ï¼Œå°† <code>attr</code> å‚æ•°èµ‹å€¼ä¸º <code>NULL</code>ï¼Œ<code>pthread_create()</code> å‡½æ•°ä¼šé‡‡ç”¨ç³»ç»Ÿé»˜è®¤çš„å±æ€§å€¼åˆ›å»ºçº¿ç¨‹ã€‚</p></li><li><p><code>void *(*start_routine) (void *)</code>ï¼šä»¥å‡½æ•°æŒ‡é’ˆçš„æ–¹å¼æŒ‡æ˜æ–°å»ºçº¿ç¨‹éœ€è¦è°ƒç”¨çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„å‚æ•°æœ€å¤šæœ‰ 1 ä¸ªï¼ˆå¯ä»¥çœç•¥ä¸å†™ï¼‰ï¼Œå½¢å‚å’Œè¿”å›å€¼çš„ç±»å‹éƒ½å¿…é¡»ä¸º <code>void*</code> ç±»å‹ã€‚</p></li><li><p><code>void *arg</code>ï¼šæŒ‡å®šä¼ é€’ç»™ <code>start_routine</code> å‡½æ•°çš„å®å‚ï¼Œå½“ä¸éœ€è¦ä¼ é€’ä»»ä½•æ•°æ®æ—¶ï¼Œå°† <code>arg</code> èµ‹å€¼ä¸º <code>NULL</code> å³å¯ã€‚</p></li></ul><h4 id=122-åˆ†ç¦»çº¿ç¨‹>1.2.2 åˆ†ç¦»çº¿ç¨‹</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>pthread_detach</span><span class=p>(</span><span class=kt>pthread_t</span> <span class=kr>thread</span><span class=p>)</span>
</span></span></code></pre></div><ul><li>è¡¨ç¤ºçº¿ç¨‹è¿è¡Œç»“æŸåèµ„æºå¯è¢«å›æ”¶ï¼ˆçº¿ç¨‹æ‰€å ç”¨å †æ ˆå’Œçº¿ç¨‹æè¿°ç¬¦ï¼‰ã€‚</li></ul><h4 id=123-æ¯”è¾ƒçº¿ç¨‹-id>1.2.3 æ¯”è¾ƒçº¿ç¨‹ ID</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>pthread_equal</span><span class=p>(</span><span class=kt>pthread_t</span> <span class=n>t1</span><span class=p>,</span> <span class=kt>pthread_t</span> <span class=n>t2</span><span class=p>)</span>
</span></span></code></pre></div><ul><li>æ¯”è¾ƒçº¿ç¨‹ <code>t1</code> å’Œ <code>t2</code> çš„çº¿ç¨‹ IDã€‚å¦‚æœç›¸ç­‰ï¼Œè¿”å›éé›¶å€¼ï¼›å¦‚æœä¸ç›¸ç­‰ï¼Œè¿”å› 0ã€‚</li></ul><h4 id=124-ç»ˆæ­¢çº¿ç¨‹>1.2.4 ç»ˆæ­¢çº¿ç¨‹</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=nf>pthread_exit</span><span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=n>value_ptr</span><span class=p>)</span>
</span></span></code></pre></div><ul><li><code>void *value_ptr</code>ï¼š å¯ä»¥æŒ‡å‘ä»»ä½•ç±»å‹çš„æ•°æ®ï¼Œå®ƒæŒ‡å‘çš„æ•°æ®å°†ä½œä¸ºçº¿ç¨‹é€€å‡ºæ—¶çš„è¿”å›å€¼ã€‚å¦‚æœçº¿ç¨‹ä¸éœ€è¦è¿”å›ä»»ä½•æ•°æ®ï¼Œå°†å‚æ•°ç½®ä¸º <code>NULL</code> å³å¯ã€‚</li></ul><h4 id=125-æŒ‚èµ·å¹¶ç­‰å¾…æŒ‡å®šçº¿ç¨‹ç»ˆæ­¢>1.2.5 æŒ‚èµ·å¹¶ç­‰å¾…æŒ‡å®šçº¿ç¨‹ç»ˆæ­¢</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>pthread_join</span><span class=p>(</span><span class=kt>pthread_t</span> <span class=kr>thread</span><span class=p>,</span> <span class=kt>void</span> <span class=o>**</span><span class=n>value_ptr</span><span class=p>)</span>
</span></span></code></pre></div><ul><li><code>pthread_t thread</code>ï¼šç­‰å¾…ç»ˆæ­¢çš„ç›®æ ‡çº¿ç¨‹ã€‚</li><li><code>void **value_ptr</code>ï¼šæ¥æ”¶åˆ°çš„è¿”å›å€¼ï¼Œä¸º <code>void pthread_exit(void *value_ptr)</code> ä¸­ <code>void *value_ptr</code> æŒ‡å‘çš„å†…å®¹ã€‚</li><li>å¦‚æœè°ƒç”¨ <code>int pthread_join()</code> å‡½æ•°çš„çº¿ç¨‹è¢«å–æ¶ˆï¼Œç›®æ ‡çº¿ç¨‹ä¸ä¼šè¢«åˆ†ç¦»ã€‚</li></ul><h4 id=126-å‘çº¿ç¨‹å‘é€ä¿¡å·>1.2.6 å‘çº¿ç¨‹å‘é€ä¿¡å·</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>pthread_kill</span><span class=p>(</span><span class=kt>pthread_t</span> <span class=kr>thread</span><span class=p>,</span> <span class=kt>int</span> <span class=n>sig</span><span class=p>)</span>
</span></span></code></pre></div><ul><li><code>sig</code>ï¼šå‘æŒ‡å®šçº¿ç¨‹ <code>pthread_t thread</code> å‘é€çš„ä¿¡å·ã€‚</li></ul><h4 id=127-ä»…ä¸€æ¬¡è°ƒç”¨æŒ‡å®šå‡½æ•°>1.2.7 ä»…ä¸€æ¬¡è°ƒç”¨æŒ‡å®šå‡½æ•°</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>pthread_once_t</span> <span class=n>once_control</span> <span class=o>=</span> <span class=n>PTHREAD_ONCE_INIT</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>pthread_once</span><span class=p>(</span><span class=kt>pthread_once_t</span> <span class=o>*</span><span class=n>once_control</span><span class=p>,</span> <span class=kt>void</span> <span class=p>(</span><span class=o>*</span><span class=n>init_routine</span><span class=p>)(</span><span class=kt>void</span><span class=p>))</span>
</span></span></code></pre></div><ul><li><code>pthread_once_t *once_control</code>ï¼šæŒ‡å®šå‡½æ•° <code>init_routine</code> æ˜¯å¦è¢«è°ƒç”¨çš„æ ‡å¿—ï¼Œéœ€èµ‹åˆå€¼ <code>PTHREAD_ONCE_INIT</code> ä»¥ä¿è¯ <code>int pthread_once()</code> å‡½æ•°æ­£å¸¸è°ƒç”¨ã€‚</li><li><code>void (*init_routine)(void)</code>ï¼šæŒ‡å®šå‡½æ•° <code>init_routine</code>ï¼Œåœ¨ <code>once_control</code> å€¼ä¸º <code>PTHREAD_ONCE_INIT</code> æ—¶ï¼Œå¯è¢«æ­£å¸¸è°ƒç”¨ï¼Œéšåä½¿ç”¨å†æ¬¡è°ƒç”¨ <code>int pthread_once()</code> å‡½æ•°ä¸ç›¸åŒ <code>once_control</code>ï¼Œå°†ä¸ä¼šå†æ¬¡è°ƒç”¨ <code>init_routine</code> å‡½æ•°ã€‚</li></ul><h4 id=128-è¿”å›çº¿ç¨‹-id>1.2.8 è¿”å›çº¿ç¨‹ ID</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>pthread_t</span> <span class=nf>pthread_self</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span></code></pre></div><ul><li>è¿”å›è°ƒç”¨è¯¥å‡½æ•°çš„çº¿ç¨‹çš„çº¿ç¨‹ IDã€‚</li></ul><h4 id=129-å‘çº¿ç¨‹å‘é€å–æ¶ˆä¿¡å·>1.2.9 å‘çº¿ç¨‹å‘é€å–æ¶ˆä¿¡å·</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>pthread_cancel</span><span class=p>(</span><span class=kt>pthread_t</span> <span class=kr>thread</span><span class=p>)</span>
</span></span></code></pre></div><ul><li>å‘é€ç»ˆæ­¢ä¿¡å·ç»™ <code>thread</code> çº¿ç¨‹ï¼Œå¦‚æœæˆåŠŸåˆ™è¿”å› 0ï¼Œå¦åˆ™ä¸ºé 0 å€¼ã€‚å‘é€æˆåŠŸå¹¶ä¸æ„å‘³ç€ <code>thread</code> ä¼šç»ˆæ­¢ã€‚</li></ul><h4 id=1210-è®¾ç½®æœ¬çº¿ç¨‹å¯¹å–æ¶ˆä¿¡å·çš„ååº”>1.2.10 è®¾ç½®æœ¬çº¿ç¨‹å¯¹å–æ¶ˆä¿¡å·çš„ååº”</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>pthread_setcancelstate</span><span class=p>(</span><span class=kt>int</span> <span class=n>state</span><span class=p>,</span> <span class=kt>int</span> <span class=o>*</span><span class=n>oldstate</span><span class=p>)</span>
</span></span></code></pre></div><ul><li><code>int state</code> ï¼šå…·æœ‰ä¸¤ç§å–å€¼ <code>PTHREAD_CANCEL_ENABLE</code>ï¼ˆç¼ºçœï¼‰å’Œ <code>PTHREAD_CANCEL_DISABLE</code>ï¼Œ
åˆ†åˆ«è¡¨ç¤ºæ”¶åˆ°ä¿¡å·åè®¾ä¸º CANCLED çŠ¶æ€å’Œå¿½ç•¥ CANCEL ä¿¡å·ç»§ç»­è¿è¡Œï¼›<code>old_state</code> å¦‚æœä¸ä¸º <code>NULL</code> åˆ™å­˜å…¥åŸæ¥çš„ Cancel çŠ¶æ€ä»¥ä¾¿æ¢å¤ã€‚</li></ul><h4 id=1211-è®¾ç½®æœ¬çº¿ç¨‹å–æ¶ˆåŠ¨ä½œçš„æ‰§è¡Œæ—¶æœº>1.2.11 è®¾ç½®æœ¬çº¿ç¨‹å–æ¶ˆåŠ¨ä½œçš„æ‰§è¡Œæ—¶æœº</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>pthread_setcanceltype</span><span class=p>(</span><span class=kt>int</span> <span class=n>type</span><span class=p>,</span> <span class=kt>int</span> <span class=o>*</span><span class=n>oldtype</span><span class=p>)</span>
</span></span></code></pre></div><ul><li><code>int type</code> ï¼šå…·æœ‰ä¸¤ç§å–å€¼ <code>PTHREAD_CANCEL_DEFFERED</code> å’Œ <code>PTHREAD_CANCEL_ASYCHRONOUS</code>ï¼Œä»…å½“ Cancel çŠ¶æ€ä¸º Enable æ—¶æœ‰æ•ˆï¼Œåˆ†åˆ«è¡¨ç¤ºæ”¶åˆ°ä¿¡å·åç»§ç»­è¿è¡Œè‡³ä¸‹ä¸€ä¸ªå–æ¶ˆç‚¹å†é€€å‡ºå’Œç«‹å³æ‰§è¡Œå–æ¶ˆåŠ¨ä½œï¼ˆé€€å‡ºï¼‰ï¼›<code>oldtype</code> å¦‚æœä¸ä¸º <code>NULL</code> åˆ™å­˜å…¥è¿æ¥çš„å–æ¶ˆåŠ¨ä½œç±»å‹å€¼ã€‚</li></ul><h4 id=1212-åˆ›å»ºçº¿ç¨‹å–æ¶ˆç‚¹>1.2.12 åˆ›å»ºçº¿ç¨‹å–æ¶ˆç‚¹</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=nf>pthread_testcancel</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span></code></pre></div><ul><li>åœ¨ä¸åŒ…å«å–æ¶ˆç‚¹ï¼Œä½†æ˜¯åˆéœ€è¦å–æ¶ˆç‚¹çš„åœ°æ–¹åˆ›å»ºä¸€ä¸ªå–æ¶ˆç‚¹ï¼Œä»¥ä¾¿åœ¨ä¸€ä¸ªæ²¡æœ‰åŒ…å«å–æ¶ˆç‚¹çš„æ‰§è¡Œä»£ç çº¿ç¨‹ä¸­å“åº”å–æ¶ˆè¯·æ±‚ã€‚</li></ul><h2 id=2-åŒæ­¥åŸè¯­>2 åŒæ­¥åŸè¯­</h2><h3 id=21-äº’æ–¥é”>2.1 äº’æ–¥é”</h3><h4 id=211ä¸»è¦å‡½æ•°æ¥å£>2.1.1ä¸»è¦å‡½æ•°æ¥å£</h4><table><thead><tr><th>å‡½æ•°å</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td><code>pthread_mutex_init()</code></td><td>åˆå§‹åŒ–ä¸€ä¸ªäº’æ–¥é”</td></tr><tr><td><code>pthread_mutex_destroy()</code></td><td>é”€æ¯ä¸€ä¸ªäº’æ–¥é”</td></tr><tr><td><code>pthread_mutex_lock()</code></td><td>åŠ é”</td></tr><tr><td><code>pthread_mutex_trylock()</code></td><td>å°è¯•åŠ é”</td></tr><tr><td><code>pthread_mutex_unlock()</code></td><td>è§£é”</td></tr></tbody></table><h4 id=212æ¥å£ç”¨æ³•>2.1.2æ¥å£ç”¨æ³•</h4><h5 id=2121åˆå§‹åŒ–ä¸€ä¸ªäº’æ–¥é”äº’æ–¥é‡>2.1.2.1åˆå§‹åŒ–ä¸€ä¸ªäº’æ–¥é”(äº’æ–¥é‡)</h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>pthread_mutex_init</span><span class=p>(</span><span class=kt>pthread_mutex_t</span> <span class=o>*</span><span class=kr>restrict</span> <span class=n>mutex</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=k>const</span> <span class=kt>pthread_mutexattr_t</span> <span class=o>*</span><span class=kr>restrict</span> <span class=n>attr</span><span class=p>);</span>
</span></span></code></pre></div><ul><li><p><strong>mutex</strong>ï¼šä¼ å‡ºå‚æ•°ï¼Œè°ƒç”¨æ—¶åº”ä¼  <strong>&amp;mutex</strong></p></li><li><p><strong>attr</strong>ï¼šäº’æ–¥é‡å±æ€§ã€‚æ˜¯ä¸€ä¸ªä¼ å…¥å‚æ•°ï¼Œé€šå¸¸ä¼ <strong>NULL</strong>ï¼Œé€‰ç”¨<strong>é»˜è®¤å±æ€§</strong>(çº¿ç¨‹é—´å…±äº«)ã€‚</p></li><li><p>äº’æ–¥é”åˆå§‹åŒ–æœ‰ä¸¤ç§æ–¹å¼ï¼š</p></li></ul><ol><li><p>é™æ€åˆå§‹åŒ–ï¼šå¦‚æœäº’æ–¥é” <strong>mutex</strong> æ˜¯é™æ€åˆ†é…çš„ï¼ˆå®šä¹‰åœ¨å…¨å±€ï¼Œæˆ–åŠ äº†staticå…³é”®å­—ä¿®é¥°ï¼‰ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å®è¿›è¡Œåˆå§‹åŒ–ã€‚<code>e.g. pthead_mutex_t muetx = PTHREAD_MUTEX_INITIALIZER;</code></p></li><li><p>åŠ¨æ€åˆå§‹åŒ–ï¼šå±€éƒ¨å˜é‡åº”é‡‡ç”¨åŠ¨æ€åˆå§‹åŒ–ã€‚<code>e.g. pthread_mutex_init(&amp;mutex, NULL)</code></p></li></ol><h5 id=2122-åŠ é”>2.1.2.2 <strong>åŠ é”</strong></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>pthread_mutex_lock</span><span class=p>(</span><span class=kt>pthread_mutex_t</span> <span class=o>*</span><span class=n>mutex</span><span class=p>);</span>
</span></span></code></pre></div><ul><li>å¯è§†ä½œmutex&ndash;</li></ul><h5 id=2123-å°è¯•åŠ é”>2.1.2.3 <strong>å°è¯•åŠ é”</strong></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>pthread_mutex_trylock</span><span class=p>(</span><span class=kt>pthread_mutex_t</span> <span class=o>*</span><span class=n>mutex</span><span class=p>);</span>
</span></span></code></pre></div><h4 id=2124è§£é”>2.1.2.4<strong>è§£é”</strong></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>pthread_mutex_unlock</span><span class=p>(</span><span class=kt>pthread_mutex_t</span> <span class=o>*</span><span class=n>mutex</span><span class=p>);</span>
</span></span></code></pre></div><ul><li>å¯è§†ä½œmutex++</li></ul><h4 id=2125é”€æ¯äº’æ–¥é”>2.1.2.5<strong>é”€æ¯äº’æ–¥é”</strong></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>pthread_mutex_destroy</span><span class=p>(</span><span class=kt>pthread_mutex_t</span> <span class=o>*</span><span class=n>mutex</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=22-æ¡ä»¶å˜é‡>2.2 æ¡ä»¶å˜é‡</h3><h4 id=221ä¸»è¦å‡½æ•°æ¥å£>2.2.1ä¸»è¦å‡½æ•°æ¥å£</h4><table><thead><tr><th>å‡½æ•°å</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td><code>pthread_cond_init()</code></td><td>åˆå§‹åŒ–ä¸€ä¸ªæ¡ä»¶å˜é‡</td></tr><tr><td><code>pthread_cond_wait()</code></td><td>é˜»å¡ç­‰å¾…ä¸€ä¸ªæ¡ä»¶å˜é‡</td></tr><tr><td><code>pthread_cond_timedwait()</code></td><td>é™æ—¶ç­‰å¾…ä¸€ä¸ªæ¡ä»¶å˜é‡</td></tr><tr><td><code>pthread_cond_signal()</code></td><td>å”¤é†’è‡³å°‘ä¸€ä¸ªé˜»å¡åœ¨æ¡ä»¶å˜é‡ä¸Šçš„çº¿ç¨‹</td></tr><tr><td><code>pthread_cond_broadcast()</code></td><td>å”¤é†’å…¨éƒ¨é˜»å¡åœ¨æ¡ä»¶å˜é‡ä¸Šçš„çº¿ç¨‹</td></tr><tr><td><code>pthread_cond_destroy()</code></td><td>é”€æ¯ä¸€ä¸ªæ¡ä»¶å˜é‡</td></tr></tbody></table><h4 id=222æ¥å£ç”¨æ³•>2.2.2æ¥å£ç”¨æ³•</h4><h5 id=2221åˆå§‹åŒ–ä¸€ä¸ªæ¡ä»¶å˜é‡>2.2.2.1<strong>åˆå§‹åŒ–ä¸€ä¸ªæ¡ä»¶å˜é‡</strong></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>pthread_cond_init</span><span class=p>(</span><span class=kt>pthread_cond_t</span> <span class=o>*</span><span class=kr>restrict</span> <span class=n>cond</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=k>const</span> <span class=kt>pthread_condattr_t</span> <span class=o>*</span><span class=kr>restrict</span> <span class=n>attr</span><span class=p>);</span> 
</span></span></code></pre></div><ul><li><p><strong>cond</strong>ï¼šä¼ å‡ºå‚æ•°ï¼Œä¼ å‡ºå‚æ•°ï¼Œè°ƒç”¨æ—¶åº”ä¼  &amp;mutex</p></li><li><p><strong>attr</strong>ï¼šattrè¡¨æ¡ä»¶å˜é‡å±æ€§ï¼Œé€šå¸¸ä¸ºé»˜è®¤å€¼ï¼Œä¼ NULLå³å¯</p></li><li><p>å¯ä»¥ä½¿ç”¨é™æ€åˆå§‹åŒ–çš„æ–¹æ³•ï¼Œåˆå§‹åŒ–æ¡ä»¶å˜é‡ï¼š</p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>pthread_cond_t</span> <span class=n>cond</span> <span class=o>=</span> <span class=n>PTHREAD_COND_INITIALIZER</span><span class=p>;</span>
</span></span></code></pre></div><h5 id=2222é˜»å¡ç­‰å¾…ä¸€ä¸ªæ¡ä»¶å˜é‡>2.2.2.2<strong>é˜»å¡ç­‰å¾…ä¸€ä¸ªæ¡ä»¶å˜é‡</strong></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>pthread_cond_wait</span><span class=p>(</span><span class=kt>pthread_cond_t</span> <span class=o>*</span><span class=kr>restrict</span> <span class=n>cond</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=kt>pthread_mutex_t</span> <span class=o>*</span><span class=kr>restrict</span> <span class=n>mutex</span><span class=p>);</span> 
</span></span></code></pre></div><ul><li>å‡½æ•°ä½œç”¨ï¼š</li></ul><ol><li><p>é˜»å¡ç­‰å¾…æ¡ä»¶å˜é‡condï¼ˆå‚1ï¼‰æ»¡è¶³</p></li><li><p>é‡Šæ”¾å·²æŒæ¡çš„äº’æ–¥é”ï¼ˆè§£é”äº’æ–¥é‡ï¼‰ç›¸å½“äº<code>pthread_mutex_unlock(&amp;mutex);</code></p><p><strong>1,2ä¸¤æ­¥ä¸ºä¸€ä¸ªåŸå­æ“ä½œã€‚</strong></p></li><li><p>å½“è¢«å”¤é†’ï¼Œ<code>pthread_cond_waitå‡½æ•°è¿”å›æ—¶ï¼Œè§£é™¤é˜»å¡å¹¶é‡æ–°ç”³è¯·è·å–äº’æ–¥é”</code>pthread_mutex_lock(&amp;mutex);</p></li></ol><h5 id=2223é™æ—¶ç­‰å¾…ä¸€ä¸ªæ¡ä»¶å˜é‡>2.2.2.3<strong>é™æ—¶ç­‰å¾…ä¸€ä¸ªæ¡ä»¶å˜é‡</strong></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>pthread_cond_timedwait</span> <span class=p>(</span><span class=kt>pthread_cond_t</span> <span class=o>*</span><span class=kr>restrict</span> <span class=n>cond</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=kt>pthread_mutex_t</span> <span class=o>*</span><span class=kr>restrict</span> <span class=n>mutex</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=k>const</span> <span class=k>struct</span> <span class=n>timespec</span> <span class=o>*</span><span class=kr>restrict</span> <span class=n>abstime</span><span class=p>);</span> 
</span></span></code></pre></div><ul><li><strong>abstimeï¼š</strong></li></ul><p>æŸ¥çœ‹struct timespecç»“æ„ä½“ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>struct</span> <span class=n>timespec</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=kt>time_t</span> <span class=n>tv_sec</span><span class=p>;</span> <span class=cm>/* seconds */</span> <span class=err>ç§’</span>
</span></span><span class=line><span class=cl><span class=kt>long</span>  <span class=n>tv_nsec</span><span class=p>;</span> <span class=cm>/* nanosecondes*/</span> <span class=err>çº³ç§’</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>å½¢å‚abstimeä½¿ç”¨çš„æ˜¯ç»å¯¹æ—¶é—´ã€‚</strong></p><p>å¦‚ï¼štime(NULL)è¿”å›çš„å°±æ˜¯ç»å¯¹æ—¶é—´ã€‚è€Œalarm(1)æ˜¯ç›¸å¯¹æ—¶é—´ï¼Œç›¸å¯¹å½“å‰æ—¶é—´å®šæ—¶1ç§’é’Ÿã€‚åˆå§‹åŒ–<code>struct timespec t = {1, 0};</code>åˆ™<code>pthread_cond_timedwait (&amp;cond, &amp;mutex, &amp;t);</code> åªèƒ½å®šæ—¶åˆ° 1970å¹´1æœˆ1æ—¥ 00:00:01ç§’ ã€‚</p><p><strong>æ­£ç¡®ç”¨æ³•ï¼š</strong></p><p>ä½¿ç”¨<code>time_t cur = time(NULL); </code>è·å–å½“å‰æ—¶é—´ã€‚</p><p>åˆå§‹åŒ–<code>struct timespec t;</code> å®šä¹‰timespec ç»“æ„ä½“å˜é‡t</p><p>ä»¤<code>t.tv_sec = cur+1;</code> å®šæ—¶1ç§’</p><p>å†è¿›è¡Œä¼ å‚<code>pthread_cond_timedwait (&amp;cond, &amp;mutex, &amp;t); </code>ä¼ å‚</p><h5 id=2224å”¤é†’è‡³å°‘ä¸€ä¸ªé˜»å¡åœ¨æ¡ä»¶å˜é‡ä¸Šçš„çº¿ç¨‹>2.2.2.4.<strong>å”¤é†’è‡³å°‘ä¸€ä¸ªé˜»å¡åœ¨æ¡ä»¶å˜é‡ä¸Šçš„çº¿ç¨‹</strong></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>pthread_cond_signal</span><span class=p>(</span><span class=kt>pthread_cond_t</span> <span class=o>*</span><span class=n>cond</span><span class=p>);</span> 
</span></span></code></pre></div><h5 id=2225å”¤é†’å…¨éƒ¨é˜»å¡åœ¨æ¡ä»¶å˜é‡ä¸Šçš„çº¿ç¨‹>2.2.2.5<strong>å”¤é†’å…¨éƒ¨é˜»å¡åœ¨æ¡ä»¶å˜é‡ä¸Šçš„çº¿ç¨‹</strong></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>pthread_cond_broadcast</span><span class=p>(</span><span class=kt>pthread_cond_t</span> <span class=o>*</span><span class=n>cond</span><span class=p>);</span> 
</span></span></code></pre></div><h5 id=2226é”€æ¯ä¸€ä¸ªæ¡ä»¶å˜é‡>2.2.2.6<strong>é”€æ¯ä¸€ä¸ªæ¡ä»¶å˜é‡</strong></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>pthread_cond_destroy</span><span class=p>(</span><span class=kt>pthread_cond_t</span> <span class=o>*</span><span class=n>cond</span><span class=p>);</span> 
</span></span></code></pre></div><h3 id=23-è¯»å†™é”>2.3 è¯»å†™é”</h3><h4 id=231ä¸»è¦å‡½æ•°æ¥å£>2.3.1ä¸»è¦å‡½æ•°æ¥å£</h4><table><thead><tr><th>å‡½æ•°å</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td><code>int pthread_rwlock_init()</code></td><td>åˆå§‹åŒ–ä¸€ä¸ªè¯»å†™é”</td></tr><tr><td><code>int pthread_rwlock_rdlock()</code></td><td>åŠ è¯»é”</td></tr><tr><td><code>int pthread_rwlock_wrlock()</code></td><td>åŠ å†™é”</td></tr><tr><td><code>int pthread_rwlock_tryrdlock()</code></td><td>å°è¯•è·å¾—è¯»æ¨¡å¼çš„è¯»å†™é”</td></tr><tr><td><code>int pthread_rwlock_trywrlock()</code></td><td>å°è¯•è·å¾—å†™æ¨¡å¼çš„è¯»å†™é”</td></tr><tr><td><code>int pthread_rwlock_unlock()</code></td><td>é‡Šæ”¾è¯»å†™é”</td></tr><tr><td><code>int pthread_rwlock_destroy()</code></td><td>é”€æ¯è¯»å†™é”</td></tr></tbody></table><h4 id=232æ¥å£ç”¨æ³•>2.3.2æ¥å£ç”¨æ³•</h4><h5 id=2321-åˆå§‹åŒ–ä¸€ä¸ªè¯»å†™é”>2.3.2.1 <strong>åˆå§‹åŒ–ä¸€ä¸ªè¯»å†™é”</strong></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>pthread_rwlock_init</span><span class=p>(</span><span class=kt>pthread_rwlock_t</span> <span class=o>*</span> <span class=n>rwlock</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=k>const</span> <span class=kt>pthread_rwlockattr_t</span> <span class=o>*</span>  <span class=n>attr</span><span class=p>);</span>
</span></span></code></pre></div><ul><li><p>rwclockä¸ºè¯»å†™é”æŒ‡é’ˆï¼Œatträ¸ºè¯»å†™é”å±æ€§æŒ‡é’ˆã€‚</p></li><li><p>å‡½æ•°æŒ‰è¯»å†™é”å±æ€§å¯¹è¯»å†™é”è¿›è¡Œåˆå§‹åŒ–ã€‚å¦‚æœ attr ä¸º NULLï¼Œåˆ™ä½¿â½¤ç¼ºçœçš„è¯»å†™é”å±æ€§ï¼Œå…¶ä½œâ½¤ä¸ä¼ é€’ç¼ºçœè¯»å†™é”å±æ€§å¯¹è±¡çš„åœ°å€ç›¸åŒã€‚åˆå§‹åŒ–è¯»å†™é”ä¹‹åï¼Œè¯¥é”å¯ä»¥ä½¿â½¤ä»»æ„æ¬¡æ•°ï¼Œâ½½â½†éœ€é‡æ–°åˆå§‹åŒ–ã€‚</p></li></ul><h5 id=2322-åŠ è¯»é”>2.3.2.2 <strong>åŠ è¯»é”</strong></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl> <span class=kt>int</span> <span class=nf>pthread_rwlock_rdlock</span><span class=p>(</span><span class=kt>pthread_rwlock_t</span> <span class=o>*</span><span class=n>rwlock</span><span class=p>);</span>
</span></span></code></pre></div><ul><li><p>åœ¨è¯»æ¨¡å¼ä¸‹é”å®šè¯»å†™é”ï¼ŒæˆåŠŸè¿”å›ï¼ï¼Œå¦åˆ™è¿”å›é”™è¯¯ç¼–å·ï¼Œ</p></li><li><p>é”™è¯¯è¿”å›å€¼çš„å®šä¹‰åªæ˜¯é’ˆå¯¹ä¸æ­£ç¡®ä½¿ç”¨è¯»å†™é”çš„æƒ…å†µ(å¦‚æœªç»åˆå§‹åŒ–çš„é”)ï¼Œæˆ–è€…è¯•å›¾è·å–å·²æ‹¥æœ‰çš„é”ä»è€Œå¯èƒ½äº§ç”Ÿæ­»é”çš„æƒ…å†µã€‚</p></li></ul><h5 id=2323-åŠ å†™é”>2.3.2.3 <strong>åŠ å†™é”</strong></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>pthread_rwlock_wrlock</span><span class=p>(</span><span class=kt>pthread_rwlock_t</span> <span class=o>*</span><span class=n>rwlock</span><span class=p>);</span>
</span></span></code></pre></div><ul><li>åœ¨å†™æ¨¡å¼ä¸‹é”å®šè¯»å†™é”,è¿”å›å€¼å¦‚åŠ è¯»é”</li></ul><h5 id=2324-å°è¯•è·å¾—è¯»æ¨¡å¼çš„è¯»å†™é”>2.3.2.4 <strong>å°è¯•è·å¾—è¯»æ¨¡å¼çš„è¯»å†™é”</strong></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>pthread_rwlock_tryrdlock</span><span class=p>(</span><span class=kt>pthread_rwlock_t</span> <span class=o>*</span><span class=n>rwlock</span><span class=p>);</span>
</span></span></code></pre></div><ul><li>å¦‚æœå¯ä»¥è·å–è¿”å›0ï¼Œä¸å¯ä»¥è·å–å‡ºé”™è¿”å›EBUSY</li></ul><h5 id=2325-å°è¯•è·å¾—å†™æ¨¡å¼çš„è¯»å†™é”>2.3.2.5 <strong>å°è¯•è·å¾—å†™æ¨¡å¼çš„è¯»å†™é”</strong></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>pthread_rwlock_trywrlock</span><span class=p>(</span><span class=kt>pthread_rwlock_t</span> <span class=o>*</span><span class=n>rwlock</span><span class=p>);</span>
</span></span></code></pre></div><ul><li>å¦‚æœå¯ä»¥è·å–è¿”å›0ï¼Œä¸å¯ä»¥è·å–å‡ºé”™è¿”å›EBUSY</li></ul><h5 id=2326-é‡Šæ”¾è¯»å†™é”>2.3.2.6 <strong>é‡Šæ”¾è¯»å†™é”</strong></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>pthread_rwlock_unlock</span><span class=p>(</span><span class=kt>pthread_rwlock_t</span> <span class=o>*</span><span class=n>rwlock</span><span class=p>);</span>
</span></span></code></pre></div><ul><li>é‡Šæ”¾è¯»å†™é”ï¼ŒåŒ…æ‹¬è¯»é”ä¸å†™é”</li></ul><h5 id=2327-é”€æ¯è¯»å†™é”>2.3.2.7 <strong>é”€æ¯è¯»å†™é”</strong></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl> <span class=kt>int</span> <span class=nf>pthread_rwlock_destroy</span><span class=p>(</span><span class=kt>pthread_rwlock_t</span> <span class=o>*</span><span class=n>rwlock</span><span class=p>);</span>
</span></span></code></pre></div><ul><li>æ­¤å‡½æ•°åªæ˜¯ååˆå§‹åŒ–è¯»å†™é”å˜é‡ï¼Œå¹¶æ²¡æœ‰é‡Šæ”¾å†…å­˜ç©ºé—´ï¼Œå¦‚æœè¯»å†™é”å˜é‡æ˜¯é€šè¿‡mallocç­‰å‡½æ•°ç”³è¯·çš„ï¼Œé‚£ä¹ˆéœ€è¦åœ¨freeæ‰è¯»å†™é”å˜é‡ä¹‹å‰è°ƒç”¨pthread_rwlock_destoryå‡½æ•°ã€‚</li></ul><h2 id=3-çº¿ç¨‹apiçš„ä½¿ç”¨å‡†åˆ™>3 çº¿ç¨‹APIçš„ä½¿ç”¨å‡†åˆ™</h2><blockquote><p>æ­¤éƒ¨åˆ†è¯‘è‡ªOSTEP 27.6 Summary</p></blockquote><p>å½“ä½ ä½¿ç”¨çº¿ç¨‹åº“æ¥æ„å»ºç¨‹åºæ—¶ï¼Œå¿…é¡»è®°ä½ä¸€äº›xioä½†å¾ˆé‡è¦çš„äº‹æƒ…ï¼š</p><ul><li><strong>ä¿æŒç®€å•</strong>ï¼š è¿™æ˜¯æœ€é‡è¦çš„ä¸€ä»¶äº‹ï¼Œä½ åº”è¯¥å°½é‡ä¿æŒä½ æ¶‰åŠåˆ°é”å®šå’Œå‘å‡ºä¿¡å·ï¼ˆlock&amp;signalï¼‰çš„ä»£ç 
ç®€å•ï¼Œä»¥å…å‡ºç°ä¸€äº›ç¥å¿…çš„çº¿ç¨‹é—´ç›¸äº’ä½œç”¨å¯¼è‡´çš„é”™è¯¯ã€‚</li><li><strong>å°½é‡å‡å°‘çº¿ç¨‹ä¹‹é—´çš„äº’åŠ¨</strong>ï¼šæ¯ä¸€ç§äº¤äº’éƒ½åº”è¯¥éƒ½è¦ä»”ç»†è€ƒè™‘ï¼Œå¹¶é‡‡ç”¨ç»è¿‡éªŒè¯çš„æ–¹æ³•æ¥æ„å»ºã€‚</li><li><strong>åˆå§‹åŒ–åŒæ­¥åŸè¯­</strong>ï¼šå¦‚æœä¸è¿™ä¹ˆåšï¼Œæœ‰æ—¶ä¼šå‡ºç°ä½ åœ¨è°ƒè¯•æ—¶ğŸˆšé—®é¢˜ï¼Œä½†æ˜¯ä¸Šç¯å¢ƒä»¥åå‡ºç°éå¸¸è¯¡å¼‚çš„é”™è¯¯ã€‚</li><li><strong>æ£€æŸ¥ä½ çš„è¿”å›ä»£ç </strong>ï¼šå½“ç„¶ï¼Œåœ¨ä½ åšçš„ä»»ä½•Cå’ŒUNIXç¼–ç¨‹ä¸­ï¼Œä½ åº”è¯¥æ£€æŸ¥æ¯ä¸€ä¸ªè¿”å›ä»£ç ã€‚
è¿™é‡Œä¹Ÿæ˜¯å¦‚æ­¤ã€‚å¦‚æœä¸è¿™æ ·åšï¼Œå°±ä¼šå¯¼è‡´å¥‡æ€ªçš„å’Œéš¾ä»¥ç†è§£çš„è¡Œä¸ºï¼Œ<del>å¯¼è‡´ä½ ç ¸é”®ç›˜</del>ã€‚</li><li><strong>åœ¨ä¼ é€’å‚æ•°å’Œè¿”å›å€¼æ—¶å°å¿ƒå¤„ç†</strong>ï¼šç‰¹åˆ«æ˜¯åœ¨ä¼ é€’åœ¨å †æ ˆç©ºé—´å†…çš„æŒ‡é’ˆæ—¶ï¼Œä½ å¯èƒ½ä¼šå‡ºé”™ã€‚</li><li><strong>æ³¨æ„æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å †æ ˆ</strong>ï¼šè¿™å’Œä¸Šä¸€æ¡ç›¸å…³è¯·è®°ä½ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å †æ ˆã€‚å› æ­¤ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ª
æœ¬åœ°åˆ†é…çš„å˜é‡ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯è¯¥çº¿ç¨‹çš„ç§æœ‰å˜é‡ï¼›å…¶ä»–çº¿ç¨‹ä¸å¯èƒ½(è½»æ˜“ï¼‰è®¿é—®å®ƒã€‚è¦åœ¨çº¿ç¨‹ä¹‹é—´å…±äº«æ•°æ®ï¼Œè¿™äº›å€¼å¿…é¡»åœ¨
åœ¨å †ä¸­ï¼Œæˆ–è€…å…¶ä»–ä¸€äº›å…¨å±€å¯è®¿é—®çš„ä½ç½®ã€‚</li><li><strong>è¯·ä½¿ç”¨æ¡ä»¶å˜é‡åœ¨çº¿ç¨‹é—´ä¼ é€’ä¿¡å·</strong>ï¼šè™½ç„¶ä½¿ç”¨ä¿¡å·ï¼ˆsignal flagï¼‰å¾ˆç®€å•ä¸”è¯±äººï¼Œä½†æ˜¯è¯·ä¸è¦è¿™ä¹ˆåšã€‚</li><li><strong>æŸ¥çœ‹æ‰‹å†Œ</strong><del>RTFM</del>ï¼šç‰¹åˆ«æ˜¯åœ¨Linuxä¸Šï¼Œpthread æ‰‹å†Œçš„ä¿¡æ¯é‡å¾ˆå¤§ï¼Œè®¨è®ºäº†å¾ˆå¤šè¿™é‡Œæå‡ºçš„ç»†å¾®å·®åˆ«ï¼Œé€šå¸¸ç”šè‡³æ›´è¯¦ç»†ã€‚ä»”ç»†é˜…è¯»å®ƒä»¬å§~</li></ul><h2 id=å‚è€ƒèµ„æ–™>å‚è€ƒèµ„æ–™</h2><ul><li><p><a href=https://en.wikipedia.org/wiki/Pthreads target=_blank rel=noopener>pthreads Wiki</a></p></li><li><p><a href="https://www.ibm.com/docs/en/aix/7.2?topic=files-pthreadh-file" target=_blank rel=noopener>pthread.h Document by IBM</a></p></li><li><p><a href=https://pubs.opengroup.org/onlinepubs/7908799/xsh/pthread.h.html target=_blank rel=noopener>pthread.h Document by OpenGroup</a></p></li><li><p><a href=https://pages.cs.wisc.edu/~remzi/OSTEP/ target=_blank rel=noopener>Operating System: Three Easy Pieces</a>,Remzi H. Arpaci-Dusseau and Andrea C. Arpaci-Dusseau, Arpaci-Dusseau Books, August, 2018 (Version 1.00)</p></li></ul></div><div class=article-tags><a class="badge badge-light" href=/tag/operating-system/>Operating System</a></div><div class=share-box><ul class=share><li><a href="https://twitter.com/intent/tweet?url=https://example.com/post/pthreads/&amp;text=A%20Brief%20Mannual%20to%20POSIX%20threads" target=_blank rel=noopener class=share-btn-twitter aria-label=twitter><i class="fab fa-twitter"></i></a></li><li><a href="https://www.facebook.com/sharer.php?u=https://example.com/post/pthreads/&amp;t=A%20Brief%20Mannual%20to%20POSIX%20threads" target=_blank rel=noopener class=share-btn-facebook aria-label=facebook><i class="fab fa-facebook"></i></a></li><li><a href="mailto:?subject=A%20Brief%20Mannual%20to%20POSIX%20threads&amp;body=https://example.com/post/pthreads/" target=_blank rel=noopener class=share-btn-email aria-label=envelope><i class="fas fa-envelope"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?url=https://example.com/post/pthreads/&amp;title=A%20Brief%20Mannual%20to%20POSIX%20threads" target=_blank rel=noopener class=share-btn-linkedin aria-label=linkedin-in><i class="fab fa-linkedin-in"></i></a></li><li><a href="whatsapp://send?text=A%20Brief%20Mannual%20to%20POSIX%20threads%20https://example.com/post/pthreads/" target=_blank rel=noopener class=share-btn-whatsapp aria-label=whatsapp><i class="fab fa-whatsapp"></i></a></li><li><a href="https://service.weibo.com/share/share.php?url=https://example.com/post/pthreads/&amp;title=A%20Brief%20Mannual%20to%20POSIX%20threads" target=_blank rel=noopener class=share-btn-weibo aria-label=weibo><i class="fab fa-weibo"></i></a></li></ul></div><div class="media author-card content-widget-hr"><a href=https://example.com/><img class="avatar mr-3 avatar-circle" src=/authors/admin/avatar_hud8f970cc34170316c401d439e994e54d_11226_270x270_fill_q75_lanczos_center.jpg alt="Luminol Chen"></a><div class=media-body><h5 class=card-title><a href=https://example.com/>Luminol Chen</a></h5><h6 class=card-subtitle>2024 Undergraduate in Cyberspace Security</h6><p class=card-text>My research interests include cryptography and blochchain.</p><ul class=network-icon aria-hidden=true><li><a href=/#contact><i class="fas fa-envelope"></i></a></li><li><a href=https://github.com/luminolt target=_blank rel=noopener><i class="fab fa-github"></i></a></li></ul></div></div></div></article></div><div class=page-footer><div class=container><footer class=site-footer><p class="powered-by copyright-license-text">Â© 2023 Me. This work is licensed under <a href=https://creativecommons.org/licenses/by-nc-nd/4.0 rel="noopener noreferrer" target=_blank>CC BY NC ND 4.0</a><br><a href=https://beian.miit.gov.cn/ target=_blank>æ²ªICPå¤‡2021013476å·-1</a></p><p class="powered-by footer-license-icons"><a href=https://creativecommons.org/licenses/by-nc-nd/4.0 rel="noopener noreferrer" target=_blank aria-label="Creative Commons"><i class="fab fa-creative-commons fa-2x" aria-hidden=true></i>
<i class="fab fa-creative-commons-by fa-2x" aria-hidden=true></i>
<i class="fab fa-creative-commons-nc fa-2x" aria-hidden=true></i>
<i class="fab fa-creative-commons-nd fa-2x" aria-hidden=true></i></a></p><!--<p class=powered-by>Published with <a href="https://wowchemy.com/?utm_campaign=poweredby" target=_blank rel=noopener>Wowchemy</a> â€” the free, <a href=https://github.com/wowchemy/wowchemy-hugo-themes target=_blank rel=noopener>open source</a> website builder that empowers creators.</p>--><br></footer></div></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script id=search-hit-fuse-template type=text/x-template>
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script><script src=https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin=anonymous></script>
<script id=page-data type=application/json>{"use_headroom":true}</script><script src=/js/wowchemy-headroom.c251366b4128fd5e6b046d4c97a62a51.js type=module></script>
<script src=/en/js/wowchemy.min.54dd6e4d8f2e4b1d098381b57f18dd83.js></script><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i> Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i> Download</a><div id=modal-error></div></div></div></div></div><script src=/js/wowchemy-publication.68f8d7090562ca65fc6d3cb3f8f2d2cb.js type=module></script></body></html>